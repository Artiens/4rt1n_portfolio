<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Portfolio de cybers√©curit√© - Write-ups CTF et classements de comp√©titions">

  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'self';
          style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
          script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
          img-src 'self' data:;
          font-src 'self';
          connect-src 'self';
        ">

  <title>Portfolio CTF | Cybers√©curit√©</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    * {margin:0; padding:0; box-sizing:border-box;}
    :root {
      --bg-dark:#0a0e27; --bg-card:#1a1f3a; --accent:#00ff88;
      --text:#e0e0e0; --text-dim:#a0a0a0; --border:#2a3f5f;
    }
    body {
      font-family:'Segoe UI',sans-serif;
      background:var(--bg-dark); color:var(--text); line-height:1.6;
      overflow-x:hidden;
    }
    header {
      background:linear-gradient(135deg,var(--bg-card) 0%,#0f1329 100%);
      padding:2rem 5%; border-bottom:2px solid var(--accent);
    }
    h1 {font-size:2.5rem; color:var(--accent); margin-bottom:0.5rem;}
    .tagline {color:var(--text-dim);}
    nav {
      background:var(--bg-card); padding:1rem 5%; position:sticky; top:0;
      border-bottom:1px solid var(--border); z-index:100;
    }
    .nav-content {max-width:1200px; margin:0 auto; display:flex; gap:2rem;}
    .nav-btn {
      background:none; border:none; color:var(--text-dim);
      cursor:pointer; padding:0.5rem 1rem; transition:0.3s;
    }
    .nav-btn:hover,.nav-btn.active {color:var(--accent);}
    .section {display:none;}
    .section.active {display:block;}
    main {max-width:1200px; margin:0 auto; padding:3rem 5%;}
    .stats-grid {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:1.5rem; margin-bottom:3rem;
    }
    .stat-card {
      background:var(--bg-card); padding:1.5rem; border-radius:10px;
      border:1px solid var(--border);
    }
    .stat-value {font-size:2.5rem; color:var(--accent); font-weight:bold;}
    .writeup-grid {display:grid; gap:1.5rem;}
    .writeup-card {
      background:var(--bg-card); border:1px solid var(--border);
      border-radius:10px; padding:1.5rem; cursor:pointer;
    }
    .writeup-card:hover {border-color:var(--accent);}
    .writeup-title {font-size:1.3rem; color:var(--accent);}
    .difficulty {padding:0.3rem 0.8rem; border-radius:5px; font-weight:bold;}
    .difficulty.easy{background:#00ff8844;color:#00ff88;}
    .difficulty.medium{background:#ffaa0044;color:#ffaa00;}
    .difficulty.hard{background:#ff004444;color:#ff4444;}
    .ranking-table {
      width:100%; background:var(--bg-card); border-radius:10px;
      border:1px solid var(--border);
    }
    .ranking-table th,.ranking-table td {padding:1rem; text-align:left;}
    .ranking-table th {background:var(--border); color:var(--accent);}
    .rank.gold{color:#ffd700;} .rank.silver{color:#c0c0c0;}
    .rank.bronze{color:#cd7f32;}
    footer {
      background:var(--bg-card); padding:2rem 5%; text-align:center;
      border-top:1px solid var(--border); margin-top:5rem; color:var(--text-dim);
    }
    .terminal-effect{font-family:'Courier New',monospace;color:var(--accent);}
    .markdown-content {
      max-width:900px; margin:0 auto; background:var(--bg-card);
      padding:2rem; border-radius:10px; border:1px solid var(--border);
    }
    .back-btn {
      background:var(--border); color:var(--text); border:none;
      padding:0.5rem 1rem; border-radius:5px; cursor:pointer; margin-bottom:1rem;
    }
    .back-btn:hover{background:var(--accent);color:var(--bg-dark);}
  </style>
</head>

<body>
  <div id="matrixBg"></div>

  <header>
    <h1 class="terminal-effect">&gt; Portfolio CTF_</h1>
    <p class="tagline">Sp√©cialiste en Cybers√©curit√© | Comp√©titeur CTF</p>
  </header>

  <nav>
    <div class="nav-content">
      <button class="nav-btn active" onclick="showSection('overview')">Vue d'ensemble</button>
      <button class="nav-btn" onclick="showSection('writeups')">Write-ups</button>
      <button class="nav-btn" onclick="showSection('rankings')">Classements</button>
    </div>
  </nav>

  <main>
    <section id="overview" class="section active">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-value" id="statChallenges">-</div><div>Challenges r√©solus</div></div>
        <div class="stat-card"><div class="stat-value" id="statCTFs">-</div><div>CTFs particip√©s</div></div>
        <div class="stat-card"><div class="stat-value" id="statWriteups">-</div><div>Write-ups publi√©s</div></div>
        <div class="stat-card"><div class="stat-value" id="statRanking">-</div><div>Meilleur classement</div></div>
      </div>
      <h2 style="color:var(--accent);margin-bottom:1.5rem;">üìå Write-ups r√©cents</h2>
      <div class="writeup-grid" id="recentWriteups"><div class="loading">Chargement...</div></div>
    </section>

    <section id="writeups" class="section">
      <div id="writeupsList">
        <h2 style="color:var(--accent);margin-bottom:1.5rem;">üìù Tous les Write-ups</h2>
        <div class="writeup-grid" id="allWriteups"><div class="loading">Chargement...</div></div>
      </div>
      <div id="writeupDetail" style="display:none;">
        <button class="back-btn" onclick="showWriteupsList()">‚Üê Retour √† la liste</button>
        <div class="markdown-content" id="writeupContent"></div>
      </div>
    </section>

    <section id="rankings" class="section">
      <h2 style="color:var(--accent);margin-bottom:1.5rem;">üèÜ Classements Comp√©titions</h2>
      <div id="rankingsTable"><div class="loading">Chargement...</div></div>
    </section>
  </main>

  <footer>
    <p>&copy; 2024 Portfolio CTF | Cybers√©curit√©</p>
    <p class="terminal-effect">Stay curious, stay secure_</p>
  </footer>

  <script>
    let writeupsData = [];
    let rankingsData = [];

    async function loadData() {
      try {
        const w = await fetch('data/writeups.json');
        if (w.ok) {
          writeupsData = await w.json();
          displayWriteups();
          updateStats();
        }
        const r = await fetch('data/rankings.json');
        if (r.ok) {
          rankingsData = await r.json();
          displayRankings();
          updateStats();
        }
      } catch (e) {
        console.error('Erreur chargement:', e);
        showError('Erreur lors du chargement des donn√©es.');
      }
    }

    function displayWriteups() {
      const recent = document.getElementById('recentWriteups');
      const all = document.getElementById('allWriteups');
      if (writeupsData.length === 0) {
        recent.innerHTML = all.innerHTML = '<p style="color:var(--text-dim);">Aucun write-up disponible</p>';
        return;
      }
      const card = (w) => `
        <div class="writeup-card" onclick="loadWriteupDetail('${w.file}')">
          <div style="display:flex;justify-content:space-between;">
            <div>
              <h3 class="writeup-title">${w.title}</h3>
              <div class="writeup-meta"><span>üèÜ ${w.ctf}</span> | <span>üìÖ ${w.date}</span></div>
            </div>
            <span class="difficulty ${w.difficulty.toLowerCase()}">${w.difficulty}</span>
          </div>
          <p>${w.description}</p>
        </div>`;
      recent.innerHTML = writeupsData.slice(0,3).map(card).join('');
      all.innerHTML = writeupsData.map(card).join('');
    }

    async function loadWriteupDetail(file) {
      try {
        const res = await fetch(`data/writeups/${file}`);
        if (!res.ok) throw new Error();
        const md = await res.text();
        document.getElementById('writeupContent').innerHTML = marked.parse(md);
        document.getElementById('writeupsList').style.display='none';
        document.getElementById('writeupDetail').style.display='block';
      } catch {
        alert('Write-up introuvable.');
      }
    }

    function showWriteupsList() {
      document.getElementById('writeupDetail').style.display='none';
      document.getElementById('writeupsList').style.display='block';
    }

    function displayRankings() {
      const c = document.getElementById('rankingsTable');
      if (rankingsData.length===0) {
        c.innerHTML='<p style="color:var(--text-dim);">Aucun classement disponible</p>';
        return;
      }
      const rankClass=(r)=>r===1?'gold':r===2?'silver':r===3?'bronze':'';
      const rankLabel=(r)=>r===1?'1er':r===2?'2e':r===3?'3e':r+'e';
      c.innerHTML=`<table class="ranking-table"><thead><tr>
        <th>Rang</th><th>Comp√©tition</th><th>Date</th><th>Points</th><th>Participants</th><th>√âquipe</th>
      </tr></thead><tbody>
      ${rankingsData.map(r=>`
        <tr>
          <td><span class="rank ${rankClass(r.rank)}">${rankLabel(r.rank)}</span></td>
          <td>${r.competition}</td><td>${r.date}</td><td>${r.points}</td>
          <td>${r.rank}/${r.participants}</td><td>${r.team}</td>
        </tr>`).join('')}
      </tbody></table>`;
    }

    function updateStats() {
      if (writeupsData.length>0) {
        document.getElementById('statWriteups').textContent=writeupsData.length;
        document.getElementById('statCTFs').textContent=new Set(writeupsData.map(w=>w.ctf)).size;
        document.getElementById('statChallenges').textContent=writeupsData.length;
      }
      if (rankingsData.length>0) {
        const best=Math.min(...rankingsData.map(r=>r.rank));
        const obj=rankingsData.find(r=>r.rank===best);
        document.getElementById('statRanking').textContent=`${best}/${obj.participants}`;
      }
    }

    function showError(m) {
      ['recentWriteups','allWriteups','rankingsTable'].forEach(id=>{
        const el=document.getElementById(id);
        if(el)el.innerHTML=`<div class="error">${m}</div>`;
      });
    }

    function showSection(id) {
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      event.target.classList.add('active');
      if(id==='writeups')showWriteupsList();
    }

    const canvas=document.createElement('canvas');
    const ctx=canvas.getContext('2d');
    document.getElementById('matrixBg').appendChild(canvas);
    canvas.width=window.innerWidth; canvas.height=window.innerHeight;
    const chars='01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà';
    const fontSize=14;
    const drops=Array(Math.floor(canvas.width/fontSize)).fill(1);
    function drawMatrix(){
      ctx.fillStyle='rgba(10,14,39,0.05)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='#00ff88'; ctx.font=fontSize+'px monospace';
      for(let i=0;i<drops.length;i++){
        const text=chars[Math.floor(Math.random()*chars.length)];
        ctx.fillText(text,i*fontSize,drops[i]*fontSize);
        if(drops[i]*fontSize>canvas.height&&Math.random()>0.975)drops[i]=0;
        drops[i]++;
      }
    }
    setInterval(drawMatrix,50);
    window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;});
    window.addEventListener('DOMContentLoaded',loadData);
  </script>
</body>
</html>
