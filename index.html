<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Portfolio CTF et Cybers√©curit√© ‚Äì Write-ups, Classements, Statistiques">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data:; connect-src 'self'; font-src 'self';">
  <title>4rt1n CTF | Cybers√©curit√©</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --bg-dark:#0a0e27;--bg-card:#1a1f3a;--accent:#00ff88;
      --text:#e0e0e0;--text-dim:#a0a0a0;--border:#2a3f5f;
    }
    html,body{height:100%}
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:var(--bg-dark);color:var(--text);
      line-height:1.6;overflow-x:hidden;position:relative;
    }
    #matrixBg{
      position:fixed;inset:0;z-index:0;
      pointer-events:none;opacity:.15;mix-blend-mode:screen;
    }
    header{
      background:linear-gradient(135deg,var(--bg-card) 0%,#0f1329 100%);
      padding:2rem 5%;border-bottom:2px solid var(--accent);
      position:relative;z-index:10;
    }
    h1{font-size:2.2rem;color:var(--accent);text-shadow:0 0 12px rgba(0,255,136,.18)}
    .tagline{color:var(--text-dim);font-size:1rem}
    nav{
      background:var(--bg-card);padding:1rem 5%;
      position:sticky;top:0;z-index:20;border-bottom:1px solid var(--border)
    }
    .nav-content{max-width:1200px;margin:0 auto;display:flex;gap:1rem}
    .nav-btn{background:none;border:none;color:var(--text-dim);font-size:1rem;cursor:pointer;padding:.5rem 1rem;transition:.2s}
    .nav-btn:hover,.nav-btn.active{color:var(--accent)}
    main{max-width:1200px;margin:0 auto;padding:3rem 5%;position:relative;z-index:15}
    .section{display:none;animation:fadeIn .35s ease-in}
    .section.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.25rem;margin-bottom:2rem}
    .stat-card{background:var(--bg-card);padding:1.25rem;border-radius:8px;border:1px solid var(--border)}
    .stat-value{font-size:2rem;color:var(--accent);font-weight:700}
    .writeup-grid{display:grid;gap:1rem}
    .writeup-card{background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:1rem;cursor:pointer;transition:.18s}
    .writeup-card:hover{transform:translateY(-4px);border-color:var(--accent)}
    .writeup-title{font-size:1.1rem;color:var(--accent);margin-bottom:.25rem}
    .writeup-meta{color:var(--text-dim);font-size:.9rem;margin-bottom:.5rem}
    .difficulty{padding:.2rem .6rem;border-radius:6px;font-weight:700;font-size:.85rem}
    .difficulty.easy{background:#00ff8844;color:#00ff88}
    .difficulty.medium{background:#ffaa0044;color:#ffaa00}
    .difficulty.hard{background:#ff004444;color:#ff4444}
    .ranking-table{width:100%;background:var(--bg-card);border-radius:8px;overflow:hidden;border:1px solid var(--border)}
    .ranking-table th,.ranking-table td{padding:.8rem;text-align:left}
    .ranking-table th{background:var(--border);color:var(--accent)}
    .rank.gold{color:#ffd700}.rank.silver{color:#c0c0c0}.rank.bronze{color:#cd7f32}
    .markdown-content{max-width:900px;margin:0 auto;background:var(--bg-card);padding:1.5rem;border-radius:8px;border:1px solid var(--border)}
    .markdown-content img{max-width:100%;border-radius:6px;margin:1rem 0;border:1px solid var(--border)}
    .back-btn{background:var(--border);color:var(--text);border:none;padding:.45rem .8rem;border-radius:6px;cursor:pointer;margin-bottom:1rem}
    .back-btn:hover{background:var(--accent);color:var(--bg-dark)}
    footer{background:var(--bg-card);padding:2rem 5%;text-align:center;border-top:1px solid var(--border);margin-top:3.5rem;color:var(--text-dim);position:relative;z-index:10}
    .loading{text-align:center;padding:2rem;color:var(--accent)}
    .error{background:#2b0000aa;border:1px solid #ff0044;padding:.75rem;border-radius:6px;color:#ffb3b3}
    .tags{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.5rem}
    .tag{background:var(--border);padding:.2rem .45rem;border-radius:5px;color:var(--text-dim);font-size:.85rem}
  </style>
</head>

<body>
  <canvas id="matrixBg" aria-hidden="true"></canvas>

  <header>
    <h1>‚ö° Portfolio CTF</h1>
    <p class="tagline">üíª Ing√©nieur en cybers√©curit√© | CTF</p>
  </header>

  <nav>
    <div class="nav-content">
      <button class="nav-btn active" onclick="showSection('overview', this)">üè† Vue d'ensemble</button>
      <button class="nav-btn" onclick="showSection('writeups', this)">üìù Write-ups</button>
      <button class="nav-btn" onclick="showSection('rankings', this)">üèÜ Classements</button>
    </div>
  </nav>

  <main>
    <section id="overview" class="section active">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-value" id="statChallenges">-</div><div>Challenges r√©solus</div></div>
        <div class="stat-card"><div class="stat-value" id="statCTFs">-</div><div>CTFs particip√©s</div></div>
        <div class="stat-card"><div class="stat-value" id="statWriteups">-</div><div>Write-ups publi√©s</div></div>
        <div class="stat-card"><div class="stat-value" id="statRanking">-</div><div>Meilleur classement</div></div>
      </div>
      <h2 style="color:var(--accent);margin-bottom:1rem;">üß† Write-ups r√©cents</h2>
      <div class="writeup-grid" id="recentWriteups"><div class="loading">Chargement...</div></div>
    </section>

    <section id="writeups" class="section">
      <div id="writeupsList">
        <h2 style="color:var(--accent);margin-bottom:1rem;">üìò Tous les Write-ups</h2>
        <div class="writeup-grid" id="allWriteups"><div class="loading">Chargement...</div></div>
      </div>
      <div id="writeupDetail" style="display:none;">
        <button class="back-btn" onclick="showWriteupsList()">‚Üê Retour</button>
        <div class="markdown-content" id="writeupContent"></div>
      </div>
    </section>

    <section id="rankings" class="section">
      <h2 style="color:var(--accent);margin-bottom:1rem;">üèÖ Classements</h2>
      <div id="rankingsTable"><div class="loading">Chargement...</div></div>
    </section>
  </main>

  <footer>
    <p>üîê Stay curious</p>
  </footer>

  <script>
    let writeupsData=[],rankingsData=[];
    async function loadData(){
      try{
        const w=await fetch('data/writeups.json');
        if(w.ok){writeupsData=await w.json();displayWriteups();updateStats();}
        const r=await fetch('data/rankings.json');
        if(r.ok){rankingsData=await r.json();displayRankings();updateStats();}
      }catch(e){console.error(e);}
    }

    function displayWriteups(){
      const r=document.getElementById('recentWriteups'),a=document.getElementById('allWriteups');
      if(!writeupsData.length){r.innerHTML=a.innerHTML='<p>Aucun write-up</p>';return;}
      const card=w=>`
      <div class="writeup-card" onclick="openWriteupFromOverview('${w.file}')">
        <div style="display:flex;justify-content:space-between;">
          <div>
            <h3 class="writeup-title">${w.title}</h3>
            <div class="writeup-meta">üèÜ ${w.ctf} ‚Ä¢ üìÖ ${w.date}</div>
          </div>
          <span class="difficulty ${w.difficulty.toLowerCase()}">${w.difficulty}</span>
        </div>
        <p style="margin-top:.6rem;color:var(--text-dim)">${w.description}</p>
        <div class="tags">${(w.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      </div>`;
      r.innerHTML=writeupsData.slice(0,3).map(card).join('');
      a.innerHTML=writeupsData.map(w=>card(w).replace("openWriteupFromOverview","loadWriteupDetail")).join('');
    }

    function openWriteupFromOverview(f){
      showSection('writeups',document.querySelector(".nav-btn[onclick*='writeups']"));
      setTimeout(()=>loadWriteupDetail(f),100);
    }

    async function loadWriteupDetail(f){
      const path=f.startsWith('writeups/')?`data/${f}`:`data/writeups/${f}`;
      const res=await fetch(path);
      if(!res.ok){alert('Write-up introuvable');return;}
      const md=await res.text();
      let html=marked.parse(md);
      // Corrige les chemins d‚Äôimages Markdown relatifs
      const base=path.substring(0,path.lastIndexOf('/')+1);
      html=html.replace(/<img\s+src="([^"]+)"/g,(m,src)=>`<img src="${base}${decodeURIComponent(src)}"`);
      document.getElementById('writeupContent').innerHTML=html;
      document.getElementById('writeupsList').style.display='none';
      document.getElementById('writeupDetail').style.display='block';
    }

    function showWriteupsList(){
      document.getElementById('writeupDetail').style.display='none';
      document.getElementById('writeupsList').style.display='block';
    }

    function displayRankings(){
      const c=document.getElementById('rankingsTable');
      if(!rankingsData.length){c.innerHTML='<p>Aucun classement</p>';return;}
      const cls=r=>r==1?'gold':r==2?'silver':r==3?'bronze':'';
      const lbl=r=>r==1?'1er':r==2?'2e':r==3?'3e':r+'e';
      c.innerHTML=`<table class="ranking-table">
        <thead><tr><th>Rang</th><th>Comp√©tition</th><th>Date</th><th>Points</th><th>Participants</th><th>√âquipe</th></tr></thead>
        <tbody>${rankingsData.map(r=>`
          <tr><td><span class="rank ${cls(r.rank)}">${lbl(r.rank)}</span></td>
          <td>${r.competition}</td><td>${r.date}</td><td>${r.points}</td>
          <td>${r.rank}/${r.participants}</td><td>${r.team}</td></tr>`).join('')}</tbody></table>`;
    }

    function updateStats(){
      if(writeupsData.length){
        statWriteups.textContent=writeupsData.length;
        statCTFs.textContent=new Set(writeupsData.map(w=>w.ctf)).size;
        statChallenges.textContent=writeupsData.length;
      }
      if(rankingsData.length){
        const best=Math.min(...rankingsData.map(r=>r.rank));
        const obj=rankingsData.find(r=>r.rank===best);
        statRanking.textContent=`${best}/${obj.participants}`;
      }
    }

    function showSection(id,btn){
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if(btn)btn.classList.add('active');
    }

    // fond matrix inchang√©
    (function(){
      const c=document.getElementById('matrixBg'),x=c.getContext('2d');
      let w,h;function size(){w=c.width=innerWidth;h=c.height=innerHeight;}
      size();window.addEventListener('resize',size);
      const ch='01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà';
      const fs=14,col=Math.floor(w/fs);const d=Array(col).fill(1);
      setInterval(()=>{
        x.fillStyle='rgba(0,0,0,0.08)';x.fillRect(0,0,w,h);
        x.fillStyle='rgba(0,255,136,0.3)';x.font=fs+'px monospace';
        for(let i=0;i<d.length;i++){
          const t=ch[Math.floor(Math.random()*ch.length)];
          x.fillText(t,i*fs,d[i]*fs);
          if(d[i]*fs>h&&Math.random()>0.975)d[i]=0;d[i]++;
        }
      },50);
    })();

    window.addEventListener('DOMContentLoaded',loadData);
  </script>
</body>
</html>
